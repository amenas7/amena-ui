<!-- Estilos críticos para evitar FOUC en Shadow DOM con CSS Variables -->
<style>
  :host {
    display: inline-block;
    vertical-align: middle;
  }
  button {
    border: none;
    border-radius: 0.375rem;
    cursor: pointer;
    outline: none;
    position: relative;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    user-select: none;
    vertical-align: middle;
    white-space: nowrap;
    font-weight: 400;
    line-height: 1;
    padding: var(--btn-size, 8px 12px);
    font-size: var(--btn-font-size, 13px);
    background-color: var(--btn-bg, #36AD55);
    border: var(--btn-border, 1px solid #36AD55);
    color: var(--btn-color, #ffffff);
    font-family: 'Nunito Sans', sans-serif;
    transition: all 0.2s ease-in-out;
  }
  
  button:hover {
    background-color: var(--btn-hover-bg, #239A5C);
  }
  
  /* Estilos críticos para el spinner */
  .spinner-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10;
    background-color: var(--btn-bg, #36AD55);
  }
  
  .spinner-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    animation: spin 1s linear infinite;
    color: var(--btn-color, #ffffff);
  }
  
  @keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }
</style>

<button
  #buttonElement
  [class]="buttonClasses"
  [type]="type"
  [attr.disabled]="disabled || loading ? '' : null"
  [disabled]="disabled || loading"
  [class.has-tooltip]="tooltip"
  (click)="onClick($event)"
  [ngStyle]="cssVariables"
>
  <!-- Contenido del botón -->
  <div class="button-content" [class.loading-hidden]="showSpinner">
    <fa-icon *ngIf="iconDefinition && (position === 'left' || iconOnly)" [icon]="iconDefinition" [class.me-1]="!iconOnly"></fa-icon>
    <span #buttonText *ngIf="!iconOnly">{{ label }}</span>
    <fa-icon *ngIf="iconDefinition && position === 'right' && !iconOnly" [icon]="iconDefinition" class="ms-1"></fa-icon>
  </div>
  
  <!-- Spinner que se superpone cuando está loading -->
  <div *ngIf="showSpinner" class="spinner-overlay">
    <fa-icon 
      [icon]="spinnerIcon" 
      class="spinner-icon"
      [class.spinning]="loading">
    </fa-icon>
  </div>
  
  <!-- Tooltip personalizado -->
  <div *ngIf="tooltip" 
       class="custom-tooltip" 
       [class.tooltip-top]="tooltipPosition === 'top'"
       [class.tooltip-bottom]="tooltipPosition === 'bottom'"
       [class.tooltip-left]="tooltipPosition === 'left'"
       [class.tooltip-right]="tooltipPosition === 'right'"
       [class.multiline]="isLongTooltip"
       [attr.data-tooltip]="tooltip">
    {{ tooltip }}
  </div>
</button>
