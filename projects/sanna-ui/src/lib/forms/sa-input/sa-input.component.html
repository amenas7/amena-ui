<div class="sa-input-container" [class.sa-input-loading]="!styleLoaded">
  <!-- Estilos críticos inline para evitar FOUC -->
  <style>
    .sa-input-container {
      display: block;
      width: 100%;
      font-family: 'Nunito Sans', sans-serif;
      opacity: 1;
      transition: opacity 0.15s ease-in-out;
    }
    .sa-input-loading {
      opacity: 0.3;
    }
    .sa-input-skeleton .form-control {
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 200% 100%;
      animation: skeleton-loading 1.5s infinite;
      border: 1px solid #dee2e6;
      border-radius: 0.375rem;
      height: 38px;
      width: 100%;
    }
    @keyframes skeleton-loading {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }
  </style>
  
  <label *ngIf="label" [for]="id" [class]="labelClasses">
    {{ label }}
    <span *ngIf="required" class="text-danger">*</span>
  </label>

  <div [class]="inputGroupClasses">
    <span *ngIf="leftIcon" class="input-group-text">
      <sa-icon 
        *ngIf="!leftIcon.includes('fa-')" 
        [name]="leftIcon" 
        size="sm">
      </sa-icon>
      <i 
        *ngIf="leftIcon.includes('fa-')" 
        [class]="leftIcon">
      </i>
    </span>

    <input
      [id]="id"
      [name]="name"
      [type]="inputType"
      [class]="inputClasses"
      [ngStyle]="inputStyles"
      [(ngModel)]="value"
      (ngModelChange)="onModelChange($event)"
      [placeholder]="placeholder"
      [required]="required"
      [readonly]="readonly"
      [disabled]="disabled"
      [autocomplete]="autocomplete"
      [min]="min"
      [max]="max"
      [minlength]="minlength"
      [maxlength]="maxlength"
      [pattern]="pattern"
      spellcheck="false"
      autocorrect="off"
      autocapitalize="off"
      data-gramm="false"
      data-gramm_editor="false"
      data-enable-grammarly="false"
      (focus)="onInputFocus($event)"
      (blur)="onInputBlur($event)"
    />

    <span *ngIf="rightIcon && type !== 'password'" class="input-group-text">
      <sa-icon 
        *ngIf="!rightIcon.includes('fa-')" 
        [name]="rightIcon" 
        size="sm">
      </sa-icon>
      <i 
        *ngIf="rightIcon.includes('fa-')" 
        [class]="rightIcon">
      </i>
    </span>

    <button
      *ngIf="type === 'password'"
      type="button"
      class="btn btn-outline-secondary"
      (click)="togglePasswordVisibility()"
      [attr.aria-label]="showPassword ? 'Ocultar contraseña' : 'Mostrar contraseña'"
    >
      <sa-icon 
        [name]="showPassword ? 'eye-slash' : 'eye'" 
        size="sm">
      </sa-icon>
    </button>
  </div>

  <div *ngIf="helperText && !errorText" [class]="helperTextClasses">{{ helperText }}</div>
  <div *ngIf="errorText" [class]="errorTextClasses">{{ errorText }}</div>
</div>